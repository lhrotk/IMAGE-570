D = dctmtx(8);q_level=10;
Q = [1   1   1   2   2   2   4   4;
          1   1   2   2   2   4   4   4;
          1   2   2   2   4   4   4   8;
          2   2   2   4   4   4   8   8;
          2   2   4   4   4   8   8   8;
          2   4   4   4   8   8   8   16;
          4   4   4   8   8   8   16 16;
           4   4   8   8   8   16 16 16];
O = imread('cameraman.tif');
I = double(O);
I = I-128;
dct = @(block_struct) round((D * block_struct.data * D')./(q_level*Q));
idct = @(block_struct) round((D' * (block_struct.data.*(q_level*Q)) * D));
G = blockproc(I,[8 8],dct);
A = blockproc(G, [8 8], idct);
A = A +128;
A = uint8(A);
figure;
subplot(1,3,1);imshow(O);title('orignal');
subplot(1,3,2);imshow(A);title('q-level 10');
subplot(1,3,3);imshow(abs(A-O), []);title('absolute diff');