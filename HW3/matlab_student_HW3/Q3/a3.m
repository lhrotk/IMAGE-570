D = dctmtx(8);q_level=10;
Q = [1   1   1   2   2   2   4   4;
          1   1   2   2   2   4   4   4;
          1   2   2   2   4   4   4   8;
          2   2   2   4   4   4   8   8;
          2   2   4   4   4   8   8   8;
          2   4   4   4   8   8   8   16;
          4   4   4   8   8   8   16 16;
           4   4   8   8   8   16 16 16];
I = imread('cameraman.tif');
I = double(I);
I = I-128;
dct_q = @(block_struct) round((D * block_struct.data * D')./(q_level*Q));
dct = @(block_struct) round(D * block_struct.data * D');
G = blockproc(I,[8 8],dct);
B = blockproc(I,[8 8],dct_q);
figure;
subplot(2,2,1);imshow(G);title('G');
subplot(2,2,2);imshow(B);title('B');
subplot(2,2,3);histogram(G, -128:127);title('G histogram');
subplot(2,2,4);histogram(B, -128:127);title('B histogram');
